# Mamba-Adaptive扫描路径生成模型 - 学术汇报要点

## 📋 目录
1. [研究背景与动机](#1-研究背景与动机)
2. [模型架构](#2-模型架构)
3. [核心创新](#3-核心创新)
4. [关键技术细节](#4-关键技术细节)
5. [训练策略](#5-训练策略)
6. [实验结果](#6-实验结果)
7. [总结与展望](#7-总结与展望)

---

## 1. 研究背景与动机

### 1.1 问题定义
- **任务**：360度全景图像的扫描路径（scanpath）生成
- **挑战**：
  - 360度图像的球面几何特性
  - 长期依赖建模
  - 全局-局部特征平衡
  - 序列生成的多样性

### 1.2 现有方法局限
- **Transformer**：O(n²)复杂度，难以处理长序列
- **RNN/LSTM**：梯度消失，难以建模长期依赖
- **传统CNN**：缺乏序列建模能力

### 1.3 我们的方案
- **Mamba状态空间模型**：O(n)复杂度，长期依赖
- **AdaptiveNN Focus机制**：高分辨率局部特征
- **双流架构**：全局-局部协同

---

## 2. 模型架构

### 2.1 整体流程图

```
输入图像 (256×512)
    ↓
[Glance网络] → 全局特征 (196×384)
    ↓
┌─────────────────────────────────┐
│  序列生成循环（30步）            │
│  ┌───────────────────────────┐  │
│  │ 1. Crop局部patch (224×224)│  │
│  │ 2. Focus网络提取局部特征  │  │
│  │ 3. 更新全局特征           │  │
│  │ 4. Mamba序列建模          │  │
│  │ 5. VAE概率预测            │  │
│  │ 6. 输出下一位置           │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
    ↓
完整扫描路径 (30×2)
```

### 2.2 核心组件

#### 2.2.1 Glance网络（全局特征提取）
- **输入**：360度图像 (256×512)
- **架构**：4层球面卷积 + ECA注意力
- **输出**：全局特征图 (14×14×384)
- **特点**：考虑球面几何，处理边界连续性

#### 2.2.2 Focus网络（局部特征提取）
- **输入**：局部patch (224×224)
- **架构**：4层标准卷积 + ECA注意力
- **输出**：局部特征 (14×14×384)
- **特点**：高分辨率细节提取

#### 2.2.3 Mamba序列建模
- **参数**：d_model=384, d_state=256
- **复杂度**：O(n)线性复杂度
- **优势**：长期依赖，参数效率高

#### 2.2.4 VAE概率建模
- **编码器**：预测均值和对数方差
- **解码器**：从隐变量解码位置
- **作用**：增加多样性，防止过拟合

---

## 3. 核心创新

### 3.1 创新点1：Mamba + AdaptiveNN融合
- **Mamba**：提供长期依赖建模能力
- **AdaptiveNN Focus**：提供高分辨率局部特征
- **协同**：全局理解 + 局部精细分析

### 3.2 创新点2：双流特征提取
- **Glance流**：快速全局理解
- **Focus流**：精细局部分析
- **动态更新**：根据注视点位置更新全局表示

### 3.3 创新点3：360度图像特殊处理
- **球面卷积**：考虑球面几何特性
- **Wrap around**：处理左右边界连续性
- **周期性编码**：X坐标使用sin/cos编码

### 3.4 创新点4：多损失函数组合
- **7种损失函数**：覆盖位置、方向、平滑、覆盖等维度
- **动态权重**：适应不同训练阶段
- **精确对齐**：序列对齐损失约束所有30步

---

## 4. 关键技术细节

### 4.1 360度图像Wrap Around处理

**X坐标（经度）**：
```python
# 左右边界连续
if x_start + patch_size > W:
    right_part = image[:, :, x_start:]
    left_part = image[:, :, :(x_start+patch_size-W)]
    patch = torch.cat([right_part, left_part], dim=3)
```

**位置预测**：
```python
# X坐标wrap around
pos_t_x = pos_t_x_raw % 1.0
# Y坐标clamp（非周期性）
pos_t_y = torch.clamp(pos_t[:, 1], 0.02, 0.98)
```

### 4.2 周期性位置编码

```python
# X坐标（经度）：周期性编码
pos_x_periodic = [sin(2πx), cos(2πx)]

# Y坐标（纬度）：直接使用（非周期性）
pos_y = y

# 组合编码
pos_encoded = encoder([sin(2πx), cos(2πx), y, bias])
```

### 4.3 Mamba序列累积

```python
# 累积历史特征（最多10步）
recent_history = history_features[-min(10, t+1):]
history_seq = torch.stack(recent_history, dim=0)  # (T, B, C)

# Mamba处理
h_t = self.mamba(history_seq)  # (B, T, C)
h_t = h_t[:, -1:, :]  # 取最后一个时间步
```

### 4.4 特征更新机制

```python
# 1. 计算空间权重（高斯分布）
spatial_weights = exp(-dist² / (2σ²))

# 2. 聚合局部特征
local_aggregate = local_features.mean(dim=1)

# 3. 门控融合
gate = sigmoid(Linear([global; update_signal]))
updated = gate * update_signal + (1-gate) * global
```

---

## 5. 训练策略

### 5.1 损失函数设计

| 损失函数 | 权重 | 作用 |
|---------|------|------|
| 重构损失 | 2.0-2.5 | 位置对齐 |
| KL散度 | 0.003 | 多样性 |
| 空间覆盖 | 2.0-2.5 | 探索整个图像 |
| 轨迹平滑 | 0.3 | 保持平滑 |
| 方向一致性 | 0.3 | 方向一致 |
| 序列对齐 | 1.5-2.0 | 所有30步对齐 |
| 边界约束 | 0.2 | 有效范围 |

### 5.2 Teacher Forcing策略

**指数衰减**：
- 初始比例：0.8
- 最终比例：0.2
- 衰减周期：50 epochs

**前几步加权**：
- 前3步：+0.15
- 3-6步：+0.08
- 6-10步：+0.03

### 5.3 优化器配置

```python
optimizer = AdamW(lr=2e-4, weight_decay=2e-3)
scheduler = CosineAnnealingLR(T_max=50, eta_min=2e-6)
```

### 5.4 自动停止机制

- **停止分类器**：预测继续概率
- **停止条件**：`continue_prob < 0.5` 且 `t >= 5`
- **应用**：推理时启用，训练时禁用

---

## 6. 实验结果

### 6.1 评估指标

| 指标 | 说明 | 目标 |
|------|------|------|
| LEV | 编辑距离（软匹配） | ↓ 越小越好 |
| DTW | 动态时间规整距离 | ↓ 越小越好 |
| REC | 重现率（相同网格数） | ↑ 越大越好 |
| SIM | 平均欧氏距离 | ↓ 越小越好 |
| MM_Vector | 方向相似度 | ↑ 越大越好 |
| MM_Length | 步长相似度 | ↑ 越大越好 |
| MM_Position | 位置相似度 | ↑ 越大越好 |

### 6.2 模型参数

- **总参数量**：~6M
- **计算复杂度**：~700M FLOPs（单次前向）
- **序列长度**：30步
- **特征维度**：384

### 6.3 关键优势

1. **高效性**：O(n)复杂度，比Transformer快
2. **准确性**：多损失函数组合，精确对齐
3. **多样性**：VAE概率建模，增加预测多样性
4. **适配性**：专门优化360度图像处理

---

## 7. 总结与展望

### 7.1 主要贡献

1. **架构创新**：Mamba + AdaptiveNN融合
2. **技术突破**：360度图像特殊处理
3. **训练策略**：多损失函数组合
4. **效率提升**：O(n)复杂度，参数效率高

### 7.2 未来工作

1. **架构改进**：
   - 多尺度特征融合（FPN）
   - 注意力机制增强
   - 混合架构（Mamba + Transformer）

2. **训练改进**：
   - 课程学习
   - 对抗训练
   - 强化学习（PPO）

3. **应用扩展**：
   - 多模态融合
   - 实时应用
   - 个性化模型

### 7.3 关键信息

- **模型名称**：Mamba-Adaptive Scanpath Generator
- **代码位置**：`scanpath_mamba_agent/scanpath_mamba_agent/`
- **主要文件**：
  - `models/mamba_adaptive_scanpath.py`：主模型
  - `train_mamba_adaptive.py`：训练脚本
  - `config_mamba_adaptive.py`：配置文件

---

## 📊 汇报建议

### 幻灯片结构建议

1. **标题页**：研究题目、作者、机构
2. **背景与动机**（2-3页）
   - 问题定义
   - 现有方法局限
   - 我们的方案
3. **模型架构**（3-4页）
   - 整体流程图
   - 核心组件详解
   - 关键创新点
4. **技术细节**（2-3页）
   - 360度图像处理
   - Mamba序列建模
   - VAE概率建模
5. **训练策略**（1-2页）
   - 损失函数设计
   - Teacher Forcing策略
6. **实验结果**（2-3页）
   - 评估指标
   - 性能对比
   - 可视化结果
7. **总结与展望**（1页）

### 重点强调

1. **Mamba的优势**：O(n)复杂度，长期依赖
2. **双流架构**：全局-局部协同
3. **360度适配**：球面卷积、wrap around
4. **训练策略**：多损失函数组合

---

**报告生成时间**：2024年
**模型版本**：Mamba-Adaptive Scanpath Generator v1.0
